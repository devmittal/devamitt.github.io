<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ECEN5013_Project1: README</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ECEN5013_Project1
   </div>
   <div id="projectbrief">Multi-Threaded Beaglebone Linux Application with sensors, logs and sockets</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">README </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><b>Advanced Embedded Software Development (AESD) – ECEN 5013 – Project 1</b></p>
<p><b>Author -Souvik De, Devansh Mittal</b></p>
<p><b>Multi-threaded BeagleBone Linux application having sensor interface, logger and sockets.</b></p>
<p>This project is a multi-threaded C application which interacts with a temperature and light sensor simultaneously and continuously logs the values in a log file.</p>
<p>The main task spawns 4 threads:</p>
<ul>
<li><a class="el" href="struct_temperature.html">Temperature</a> sensor thread which is responsible for interacting with the TMP102 temperature sensor over MT-safe I2C</li>
<li><a class="el" href="struct_light.html">Light</a> sensor thread which is responsible for interacting with the APDs9301 light sensor over MT-safe I2C</li>
<li>Logger thread which is responsible for logging sensor values, errors and sensor status.</li>
<li>Remote thread which runs a TCP server and accepts connections from clients with various requests like temperature value and lux value</li>
</ul>
<p>Sanity Checks:</p>
<ul>
<li>Start up tests for each sensor</li>
<li>Regular monitoring and logging of status of each thread (heartbeat check).</li>
<li>Unit Tests.</li>
</ul>
<p>If any of the 2 sensors fail or are stuck for more than a timeout, the main task gracefully closes that thread. If the logger thread fails, the main task closes all the threads and gracefully exits the program. Any failure is indicated by an LED on the BeagleBone.</p>
<p>Functions and their descriptions:</p>
<p><b><a class="el" href="i2c_8h.html">i2c.h</a></b></p>
<p>init_i2c: This function initializes the I2C bus</p>
<p>write_i2c: This function writes 8-bit data to the I2C Bus</p>
<p>write_i2c16: This function writes 16-bit data to the I2C Bus</p>
<p>read_i2c16: This function reads 16-bit data from the I2C Bus</p>
<p>read_i2c8: This function reads 8-bit data from the I2C Bus</p>
<p>close_i2c: This function concludes the I2C Communication.</p>
<p>write_i2c16_config: This function writes 24-bit data to the I2C Bus to write to the configuration register of the temperature sensor.</p>
<p><b><a class="el" href="led_8h.html">led.h</a></b></p>
<p>led: This function switches the LED on and off</p>
<p><b><a class="el" href="light_sensor_8h.html">lightSensor.h</a></b></p>
<p>startup_test: This function checks the identification register as part of a startup test and confirms if the light sensor is working properly.</p>
<p>power_up: This function powers up the light sensor.</p>
<p>read_control_register: This function reads control register of the light sensor.</p>
<p>set_timing_register: This function is used to set the integration time and gain of light sensor.</p>
<p>read_timing_register: This function reads timing register of the light sensor.</p>
<p>enable_interrupt: This function enables interrupts in the interrupt control register of the light sensor.</p>
<p>disable_interrupt: This function disable interrupts of the light sensor.</p>
<p>set_interrupt_threshold: This function sets the high and low interrupt threshold of the light sensor.</p>
<p>read_interrupt_threshold: This function reads the high and low interrupt threshold of the light sensor.</p>
<p>read_visible_light: This function reads channel 0 of light sensor.</p>
<p>read_IR_light: This function reads channel 1 of light sensor.</p>
<p>cal_lumen: This function calculates actual luminosity based on channel 0 and channel 1 lux values of light sensor.</p>
<p>change: This function checks if there is any change in light state from the previous state.</p>
<p>state: This function determines current light state based on threshold value.</p>
<p>read_LightSensor: This function calls functions to read channel 0 and 1, calculate lumen, determine current light state, and if there was a change from previous state and stores it in the allocated structure.</p>
<p><b><a class="el" href="logger_8h.html">logger.h</a></b></p>
<p>write_log: This function logs events, errors, and heartbeat notifications generated by the program</p>
<p><b><a class="el" href="message_8h.html">message.h</a></b></p>
<p>init_MessageQueues: This function initializes all the message queues</p>
<p>dest_MessageQueues: This function destroys (closes and unlinks) all the message queues</p>
<p>open_MessageQueue: This function opens a message queue identified by its parameters</p>
<p>send_Message: This function is used to send messages through a queue identified by the first parameter</p>
<p>recv_Message: This function is used to receive messages through a queue identified by the first parameter</p>
<p>CloseUnlinkQueue: This function closes and unlinks a message queue identified by the first parameter</p>
<p><b><a class="el" href="remote_task_8h.html">remoteTask.h</a></b></p>
<p>init_socket: This function initializes the socket at the server side</p>
<p>send_data: This function sends data through a socket from server to client</p>
<p>read_data: This function reads data sent from client to server via a socket</p>
<p><b><a class="el" href="temperature_8h.html">temperature.h</a></b></p>
<p>read_temperature: This function reads the temperature register of the temperature sensor</p>
<p>cal_temp: This function calculates actual temperature in celsius, fahrenheit, and kelvin based on digital temperature values read from the temperature register</p>
<p>read_Tlow: This function reads the lower temperature limit from the tlow register of the temperature sensor.</p>
<p>read_Thigh: This function reads the higher temperature limit from the thigh register of the temperature sensor</p>
<p>read_configuration_reg: This function reads the configuration register of the temperature sensor</p>
<p>set_shutdown: This function sets the shutdown mode in the configuration register of the temperature register</p>
<p>disable_shutdown: This function disables the shutdown mode in the configuration register of the temperature register</p>
<p>read_fault: This function reads the fault bits from the configuration register of the temperature register</p>
<p>read_em: This function reads the extended mode bit in the configuration register of the temperature register.</p>
<p>write_em: This function sets/disables the extended mode in the configuration register of the temperature register</p>
<p>read_conversion_rate: This function reads the conversion rate bits in the configuration register of the temperature register</p>
<p>set_conversion_rate: This function sets the conversion rate bits in the configuration register of the temperature register</p>
<p>write_fault: This function sets the fault bits in the configuration register of the temperature register</p>
<p><b><a class="el" href="clientprocess_8h.html">clientprocess.h</a></b></p>
<p>init_socket: This function initializes the socket at the client side</p>
<p>send_data: This function sends data through a socket from client to server</p>
<p>read_data: This function reads data sent from server to client via a socket</p>
<p><b><a class="el" href="main_8c.html">main.c</a></b></p>
<p>kill_signal_handler: Signal handler for signal SIGINT aka Ctrl-C</p>
<p>getSensorData: Common call back function for temperature and light timer</p>
<p>timer_init: This function initializes a unique timer on demand for every requesting thread</p>
<p>temperature: <a class="el" href="struct_temperature.html">Temperature</a> thread callback function</p>
<p>light: <a class="el" href="struct_light.html">Light</a> thread callback function</p>
<p>logger: Logger thread callback function</p>
<p>remote: Remote task thread callback function</p>
<p>check_heartbeat: This function registers heart beats from different threads and sends relevant data to the logger.</p>
<p>setup_signalhandler: This function initialize a signal handler to kill any particular thread or the process itself.</p>
<p>Unit Tests</p>
<p><b><a class="el" href="struct_light.html">Light</a> Sensor Task</b></p>
<p>Start-up Test: Read ID register to verify light sensor is functional</p>
<p>Power-up Test: Read Control register to verify that light sensor has powered up</p>
<p>Timing Register Test: Set random integration and gain values and check if it is writing to the register by reading it.</p>
<p>Lumen Calculation Test: With random channel 0 and channel 1 lux values, the lumen calculation formula is tested to see if we are getting correct luminosity.</p>
<p><b><a class="el" href="struct_temperature.html">Temperature</a> Sensor Task</b></p>
<p><a class="el" href="struct_temperature.html">Temperature</a> Calculation Test: With random digital temperature values, it is tested whether the correct temperature values in Celsius, Fahrenheit and Kelvin are obtained.</p>
<p>Tlow Register Test: The Tlow register is read to test if the default value of 75 Celsius is obtained.</p>
<p>Thigh Register Test: The Thigh register is read to test if the default value of 80 Celsius is obtained.</p>
<p>Configuration Register Test: The configuration register is read to test if the default value of 0x60A0 is obtained.</p>
<p><b>Logger Task</b></p>
<p>File Creation Test: The function which creates the file is called to test if the file is created without any errors.</p>
<p>Start-up Tests</p>
<p><b><a class="el" href="struct_light.html">Light</a> Sensor Task</b>: The ID register is read and then checked if it correctly equals 0x50.</p>
<p><b><a class="el" href="struct_temperature.html">Temperature</a> Sensor Task</b>: The configuration register is read and checked if it correctly equals the default value of 0x60A0.</p>
<p><b>Logger Task</b>: The start-up test constitutes the logger thread spawning and a file being created. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
